<!DOCTYPE HTML>
<html class="p2">
<head>
<meta charset="utf-8">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="yes" name="apple-touch-fullscreen">
<meta content="telephone=no,email=no" name="format-detection">
<meta name="App-Config" content="fullscreen=yes,useHistoryState=yes,transition=yes">
<script>!function(){var e="@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",t=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.disabled||(t.styleSheet.cssText=e);else try{t.innerHTML=e}catch(o){t.innerText=e}}()</script>
<script>!function(e,t){function i(){var t=n.getBoundingClientRect().width;t/m>540&&(t=540*m);var i=t/10;n.style.fontSize=i+"px",s.rem=e.rem=i}var a,r=e.document,n=r.documentElement,o=r.querySelector('meta[name="viewport"]'),l=r.querySelector('meta[name="flexible"]'),m=0,d=0,s=t.flexible||(t.flexible={});if(o){console.warn("将根据已有的meta标签来设置缩放比例");var c=o.getAttribute("content").match(/initial\-scale=([\d\.]+)/);c&&(d=parseFloat(c[1]),m=parseInt(1/d))}else if(l){var p=l.getAttribute("content");if(p){var u=p.match(/initial\-dpr=([\d\.]+)/),f=p.match(/maximum\-dpr=([\d\.]+)/);u&&(m=parseFloat(u[1]),d=parseFloat((1/m).toFixed(2))),f&&(m=parseFloat(f[1]),d=parseFloat((1/m).toFixed(2)))}}if(!m&&!d){var h=e.navigator.userAgent,v=(!!h.match(/android/gi),!!h.match(/iphone/gi)),x=v&&!!h.match(/OS 9_3/),b=e.devicePixelRatio;m=v&&!x?b>=3&&(!m||m>=3)?3:b>=2&&(!m||m>=2)?2:1:1,d=1/m}if(n.setAttribute("data-dpr",m),!o)if(o=r.createElement("meta"),o.setAttribute("name","viewport"),o.setAttribute("content","initial-scale="+d+", maximum-scale="+d+", minimum-scale="+d+", user-scalable=no"),n.firstElementChild)n.firstElementChild.appendChild(o);else{var w=r.createElement("div");w.appendChild(o),r.write(w.innerHTML)}e.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(i,300)},!1),e.addEventListener("pageshow",function(e){e.persisted&&(clearTimeout(a),a=setTimeout(i,300))},!1),"complete"===r.readyState?r.body.style.fontSize=12*m+"px":r.addEventListener("DOMContentLoaded",function(){r.body.style.fontSize=12*m+"px"},!1),i(),s.dpr=e.dpr=m,s.refreshRem=i,s.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"==typeof e&&e.match(/rem$/)&&(t+="px"),t},s.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"==typeof e&&e.match(/px$/)&&(t+="rem"),t}}(window,window.lib||(window.lib={}))</script>
<title>swipe.js</title>
<script>function testscreen(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?"phone":"pc"};var screen=testscreen()</script>
<style>
	div{box-sizing: border-box;}
	h1{font-size:1rem;text-align: center;margin:.2rem 0;}
	h2{font-size:.5rem;margin:.2rem 0;text-indent: .2rem;}
	h3{font-size:.3rem;margin:.5rem 0 .2rem;text-indent: 2em;user-select:none;-webkit-user-select:none;}
	pre{width:10rem;overflow: scroll;background: #EEC591}
	.pbp{font-size:.3rem;text-indent: 2em;}
	#swipeEvent{background: #388E8E;color:#fff;text-indent: .2rem;}
	#swipeEvent p{font-size: .3rem}
	#swipeEvent span{float:right;margin-right: 4rem}
	.horizontal{position:relative;width:100%;height:3rem;background: #A2CD5A;overflow: hidden;}
	.hswipe_wrap{position:absolute;width:30rem;height:3rem;background:#388E8E;font-size:1rem;text-align: center;line-height: 3rem;color:#fff;transform: translate3d(0,0,0);-webkit-transform: translate3d(0,0,0);}
	.hswipe_wrap>div{float:left;width:10rem;height:3rem;border:1px solid #fff;}
	.tags{width:2rem;height:2rem;margin:0 auto;text-align:center;line-height:2rem;color:#fff;background: #388E8E;border-radius: 1rem;opacity: 1;user-select:none;-webkit-user-select:none;}
	.drag{position:relative;width:10rem;height:5rem;background: #388E8E;}
	.dragtg{position:absolute;top:50%;left:50%;width:1rem;height:1rem;background:#2E2E2E;}
</style>
</head>
<body>
<h1>swipe.js</h1>
<h2>事件触发，需要注意的地方：</h2>
<p class="pbp">同时绑定事件用空格隔开</p>
<p class="pbp">touchEnd不会和tag、longtag、上下左右滑动事件同时触发</p>
<p class="pbp">touchStart始终会触发、drag位移后始终触发</p>
<p class="pbp">触发tag判定时间为150毫秒内位移距离小于4</p>
<p class="pbp">触发longTag判定时间为500毫秒内未抬起手指并且位移距离小于4</p>
<p style="margin-bottom:.3rem;" class="pbp">触发swipe四个方向判定时间为150毫秒内抬起手指，范围各占90度</p>
<div id="swipeEvent">
	<p>触摸开始touchStart<span></span></p>
	<p>拖拽drag<span></span></p>
	<p>垂直方向拖拽dragVertical<span></span></p>
	<p>水平方向拖拽dragHorizontal<span></span></p>
	<p>快速左滑swipeLeft<span></span></p>
	<p>快速右滑swipeRight<span></span></p>
	<p>快速上滑swipeUp<span></span></p>
	<p>快速下滑swipeDown<span></span></p>
	<p>轻击tag<span></span></p>
	<p>长按longTag<span></span></p>
	<p>触摸结束touchEnd<span></span></p>
</div>
<h2>栗子：</h2>
<h3>swipe.js左右轮播</h3>
<div class="horizontal">
	<div class="hswipe_wrap">
		<div>1</div>
		<div>2</div>
		<div>3</div>
	</div>
</div>
<h3>实现代码，上下滑动同理，我就不举例了</h3>
<div class="pre">
<pre>
+function(){
	var hl,tl,
		hw = document.querySelector('.horizontal').offsetWidth,
		target;
	DJ.toucher('.hswipe_wrap').on('touchStart',function(e){
		hl = parseFloat(getComputedStyle(this)['transform'].split(',')[4]);
		stop(this, hl);
	}).on('dragHorizontal',function(e, s){
		// 水平滑动阻止默认事件----窗口滚动
		e.preventDefault();
		this.style.cssText = 'transform:translate3d('+ (tl = hl + s.disx) +'px,0,0)';
	}).on('swipeLeft',function(e){
		target = Math.round(tl/hw) * hw - hw;
		go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
	}).on('swipeRight',function(e){
		target = Math.round(tl/hw) * hw + hw;
		go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
	}).on('touchEnd tag longTag',function(e){
		tl = parseFloat(getComputedStyle(this)['transform'].split(',')[4]);
		target = Math.round(tl/hw) * hw;
		go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
	})
	function go(obj, t){
		obj.style.cssText = 'transform:translate3d('+ t +'px,0,0);-webkit-transform:translate3d('+ t +'px,0,0);transition:all .3s;-webkit-transition:all .3s;';
	}
	function stop(obj, t){
		obj.style.cssText = 'transform:translate3d('+ t +'px,0,0);-webkit-transform:translate3d('+ t +'px,0,0);transition:none;-webkit-transition:none;';
	}
}();
</pre>
</div>
<h3>轻击和长按</h3>
<div class="tags"></div>
<h3>拖拽</h3>
<div class='drag'>
	<div class="dragtg"></div>
</div>
<h3>实现代码</h3>
<div>
<pre>
+function(){
	var oD = document.querySelector('.drag'),
		cD = oD.children[0],
		maxw = oD.offsetWidth - cD.offsetWidth,
		maxh = oD.offsetHeight - cD.offsetHeight,
		l,t;
	DJ.toucher('.dragtg').on('touchStart',function(e){
		e.preventDefault();
		l = this.offsetLeft;
		t = this.offsetTop;
	}).on('drag',function(e,s){
		var tl = l + s.disx,
			tt = t + s.disy;
		this.style.left = ctnumber(tl, maxw) + 'px';
		this.style.top = ctnumber(tt, maxh) + 'px';
	});
	function ctnumber(x,max) {
		return x < 0 ? 0 : x > max ? max : x;
	}
}();
</pre>
</div>
<script src="js/Djswipe.js"></script>
<script>
window.onload = function() {
	if(screen !== 'phone') {
		alert('请在手机或者chrome手机调试模式下测试！');
		return false;
	}
	var aS = document.querySelectorAll('#swipeEvent span');
	DJ.toucher('#swipeEvent').on('touchStart',function(e){
		e.preventDefault();
		for(var i=0;aS[i];aS[i++].innerHTML = '');
		aS[0].innerHTML = '√';
	}).on('drag',function(e,s){
		aS[1].innerHTML = '√';
	}).on('dragVertical',function(e,s){
		aS[2].innerHTML = '√';
	}).on('dragHorizontal',function(e,s){
		aS[3].innerHTML = '√';
	}).on('swipeLeft',function(e){
		aS[4].innerHTML = '√';
	}).on('swipeRight',function(e){
		aS[5].innerHTML = '√';
	}).on('swipeUp',function(e){
		aS[6].innerHTML = '√';
	}).on('swipeDown',function(e){
		aS[7].innerHTML = '√';
	}).on('tag',function(e){
		aS[8].innerHTML = '√';
	}).on('longTag',function(e){
		aS[9].innerHTML = '√';
	}).on('touchEnd',function(e){
		aS[10].innerHTML = '√';
	});
// 栗子1
	+function(){
		var hl,tl,
			hw = document.querySelector('.horizontal').offsetWidth,
			target;
		DJ.toucher('.hswipe_wrap').on('touchStart',function(e){
			hl = parseFloat(getComputedStyle(this)['transform'].split(',')[4]);
			stop(this, hl);
		}).on('dragHorizontal',function(e, s){
			// 水平滑动阻止默认事件----窗口滚动
			e.preventDefault();
			this.style.cssText = 'transform:translate3d('+ (tl = hl + s.disx) +'px,0,0)';
		}).on('swipeLeft',function(e){
			target = Math.round(tl/hw) * hw - hw;
			go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
		}).on('swipeRight',function(e){
			target = Math.round(tl/hw) * hw + hw;
			go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
		}).on('touchEnd tag longTag',function(e){
			tl = parseFloat(getComputedStyle(this)['transform'].split(',')[4]);
			target = Math.round(tl/hw) * hw;
			go(this, target > 0 ? 0 : target < -hw * 2 ? -hw * 2 : target);
		})
		function go(obj, t){
			obj.style.cssText = 'transform:translate3d('+ t +'px,0,0);-webkit-transform:translate3d('+ t +'px,0,0);transition:all .3s;-webkit-transition:all .3s;';
		}
		function stop(obj, t){
			obj.style.cssText = 'transform:translate3d('+ t +'px,0,0);-webkit-transform:translate3d('+ t +'px,0,0);transition:none;-webkit-transition:none;';
		}
	}();
	
	DJ.toucher('.tags').on('tag',function(e){
		this.innerHTML = 'tag';
		this.style.cssText = '';
	}).on('longTag',function(e){
		this.innerHTML = 'longTag';
		this.style.cssText = 'transform: scale3d(1.1,1.1,1.1);-webkit-transform: scale3d(1.1,1.1,1.1);opacity:.5;';
	});

	+function(){
		var oD = document.querySelector('.drag'),
			cD = oD.children[0],
			maxw = oD.offsetWidth - cD.offsetWidth,
			maxh = oD.offsetHeight - cD.offsetHeight,
			l,t;
		DJ.toucher('.dragtg').on('touchStart',function(e){
			e.preventDefault();
			l = this.offsetLeft;
			t = this.offsetTop;
		}).on('drag',function(e,s){
			var tl = l + s.disx,
				tt = t + s.disy;
			this.style.left = ctnumber(tl, maxw) + 'px';
			this.style.top = ctnumber(tt, maxh) + 'px';
		});
		function ctnumber(x,max) {
			return x < 0 ? 0 : x > max ? max : x;
		}
	}();
}
</script>
</body>
</html>
